<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagramador - Flowchart & Diagramas</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Barra superior tipo draw.io -->
  <header class="toolbar">
    <div class="menu-bar">
      <button class="menu-btn" title="Archivo">Archivo</button>
      <button class="menu-btn" title="Editar">Editar</button>
      <button class="menu-btn" title="Ver">Ver</button>
      <button class="menu-btn" title="DiseÃ±o">DiseÃ±o</button>
      <button class="menu-btn" title="Ayuda">Ayuda</button>
    </div>
      <div class="toolbar-actions">
      <button class="icon-btn" id="btn-new" title="Nuevo">ðŸ“„</button>
      <button class="icon-btn" id="btn-open" title="Abrir diagrama">ðŸ“‚</button>
      <button class="icon-btn" id="btn-save" title="Guardar diagrama (JSON)">ðŸ’¾</button>
      <button class="icon-btn" id="btn-export-sql" title="Exportar SQL">SQL</button>
      <span class="separator"></span>
      <button class="icon-btn" id="btn-undo" title="Deshacer">â†¶</button>
      <button class="icon-btn" id="btn-redo" title="Rehacer">â†·</button>
      <span class="separator"></span>
      <button class="icon-btn" id="btn-zoom-out" title="Alejar">âˆ’</button>
      <span class="zoom-label" id="zoom-value">100%</span>
      <button class="icon-btn" id="btn-zoom-in" title="Acercar">+</button>
      <span class="separator"></span>
      <button class="icon-btn" id="btn-delete" title="Eliminar">ðŸ—‘</button>
    </div>
  </header>

  <div class="app-container">
    <!-- Panel izquierdo: formas -->
    <aside class="shapes-panel">
      <div class="panel-header">
        <span>Formas</span>
        <input type="text" class="shape-search" placeholder="Buscar..." id="shape-search">
      </div>
      <div class="shape-categories">
        <details open>
          <summary>Flujo</summary>
          <div class="shape-list" data-category="flow">
            <div class="shape-item" data-shape="rect" title="RectÃ¡ngulo">
              <svg viewBox="0 0 100 60" width="48" height="28"><rect x="5" y="5" width="90" height="50" rx="4" fill="var(--shape-fill)" stroke="var(--shape-stroke)"/></svg>
            </div>
            <div class="shape-item" data-shape="rounded" title="RectÃ¡ngulo redondeado">
              <svg viewBox="0 0 100 60" width="48" height="28"><rect x="5" y="5" width="90" height="50" rx="12" fill="var(--shape-fill)" stroke="var(--shape-stroke)"/></svg>
            </div>
            <div class="shape-item" data-shape="diamond" title="Rombo">
              <svg viewBox="0 0 100 60" width="48" height="28"><polygon points="50,5 95,30 50,55 5,30" fill="var(--shape-fill)" stroke="var(--shape-stroke)"/></svg>
            </div>
            <div class="shape-item" data-shape="ellipse" title="Elipse">
              <svg viewBox="0 0 100 60" width="48" height="28"><ellipse cx="50" cy="30" rx="45" ry="25" fill="var(--shape-fill)" stroke="var(--shape-stroke)"/></svg>
            </div>
            <div class="shape-item" data-shape="parallelogram" title="Paralelogramo">
              <svg viewBox="0 0 100 60" width="48" height="28"><polygon points="25,5 95,5 75,55 5,55" fill="var(--shape-fill)" stroke="var(--shape-stroke)"/></svg>
            </div>
            <div class="shape-item" data-shape="hexagon" title="HexÃ¡gono">
              <svg viewBox="0 0 100 60" width="48" height="28"><polygon points="25,5 75,5 95,30 75,55 25,55 5,30" fill="var(--shape-fill)" stroke="var(--shape-stroke)"/></svg>
            </div>
          </div>
        </details>
        <details>
          <summary>Flechas</summary>
          <div class="shape-list" data-category="arrows">
            <div class="shape-item" data-shape="arrow-right" title="Flecha derecha">
              <svg viewBox="0 0 100 40" width="48" height="20"><polygon points="5,20 75,5 75,15 95,20 75,25 75,35" fill="var(--shape-fill)" stroke="var(--shape-stroke)"/></svg>
            </div>
            <div class="shape-item" data-shape="arrow-down" title="Flecha abajo">
              <svg viewBox="0 0 40 100" width="20" height="48"><polygon points="20,95 5,25 15,25 15,5 25,5 25,25 35,25" fill="var(--shape-fill)" stroke="var(--shape-stroke)"/></svg>
            </div>
          </div>
        </details>
        <details open>
          <summary>Base de datos</summary>
          <div class="shape-list" data-category="database">
            <div class="shape-item shape-item-table" data-shape="table" title="Tabla (entidad)">
              <svg viewBox="0 0 120 70" width="56" height="36">
                <rect x="2" y="2" width="116" height="24" rx="2" fill="#1a73e8" stroke="#1557b0"/>
                <text x="60" y="17" text-anchor="middle" fill="#fff" font-size="11" font-weight="bold">Tabla</text>
                <line x1="2" y1="26" x2="118" y2="26" stroke="#d0d0d0"/>
                <rect x="2" y="26" width="116" height="20" fill="#f5f5f5" stroke="#d0d0d0"/>
                <text x="8" y="40" font-size="10" fill="#333">id INT PK</text>
                <line x1="2" y1="46" x2="118" y2="46" stroke="#d0d0d0"/>
                <rect x="2" y="46" width="116" height="20" fill="#fff" stroke="#d0d0d0"/>
                <text x="8" y="60" font-size="10" fill="#333">nombre VARCHAR</text>
              </svg>
            </div>
          </div>
        </details>
      </div>
    </aside>

    <!-- Ãrea central: lienzo -->
    <main class="canvas-wrapper" id="canvas-wrapper">
      <div class="canvas-container" id="canvas-container">
        <svg class="canvas-grid" id="canvas-grid" xmlns="http://www.w3.org/2000/svg"></svg>
        <svg class="canvas-svg" id="canvas-svg" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--stroke-color)" />
            </marker>
          </defs>
          <g id="connections-layer"></g>
          <g id="shapes-layer"></g>
        </svg>
      </div>
    </main>

    <!-- Panel derecho: formato (opcional) -->
    <aside class="format-panel" id="format-panel">
      <div class="panel-header">
        <span>Formato</span>
      </div>
      <div class="format-content" id="format-content">
        <p class="hint">Selecciona una forma para editar su estilo.</p>
        <div class="format-section hidden" id="format-section">
          <label>Texto</label>
          <input type="text" id="shape-text" placeholder="Texto de la forma">
          <label>Color de relleno</label>
          <input type="color" id="shape-fill-color" value="#ffffff">
          <label>Color de borde</label>
          <input type="color" id="shape-stroke-color" value="#1a1a2e">
        </div>
        <div class="format-section hidden" id="format-section-table">
          <button type="button" class="btn-primary" id="btn-edit-table">Editar tabla (columnas y relaciones)</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Modal editar tabla -->
  <div class="modal-overlay hidden" id="modal-table">
    <div class="modal">
      <div class="modal-header">
        <h2>Editar tabla</h2>
        <button type="button" class="modal-close" id="modal-table-close">Ã—</button>
      </div>
      <div class="modal-body">
        <label>Nombre de la tabla</label>
        <input type="text" id="table-name" placeholder="ej: usuarios">
        <label>Columnas</label>
        <div id="table-columns-list"></div>
        <button type="button" class="btn-secondary" id="btn-add-column">+ AÃ±adir columna</button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="modal-table-cancel">Cancelar</button>
        <button type="button" class="btn-primary" id="modal-table-ok">Aplicar</button>
      </div>
    </div>
  </div>

  <!-- Modal ver/copiar SQL -->
  <div class="modal-overlay hidden" id="modal-sql">
    <div class="modal modal-sql">
      <div class="modal-header">
        <h2>SQL generado</h2>
        <button type="button" class="modal-close" id="modal-sql-close">Ã—</button>
      </div>
      <div class="modal-body">
        <textarea id="sql-output" readonly></textarea>
        <div class="modal-sql-actions">
          <button type="button" class="btn-primary" id="btn-copy-sql">Copiar al portapapeles</button>
          <button type="button" class="btn-secondary" id="btn-download-sql">Descargar .sql</button>
        </div>
      </div>
    </div>
  </div>

  <input type="file" id="file-input" accept=".json" hidden>
  <script src="app.js"></script>
</body>
</html>
